<% per_name = Name.find(@person.name_id).name %>
<% provide(:title, per_name) %>

<table>
  <tr class='current_row'>
    <td><%= per_name %></td>
    <td><%= @person.team.name %></td>
    <td><%= @person.start.to_formatted_s(:long)  %></td>
    <td><%= @person.end.to_formatted_s(:long) unless !@person.end  %></td>
    <td><%= @person.fte %></td>
    <td><%= @person.brexit %></td>

    <% @person.versions.reverse.each do |v| %>
      <% if v.event == "create" %>
        <td>Created</td>
        <td><%= v.created_at.to_formatted_s(:long) %></td>
      <% end %>
      <% if v.event == "update" %>
        <td>Updated</td>
        <td><%= v.created_at.to_formatted_s(:long) %></td>
      <% end %>
      </tr>
      <% if v.event == "update" %>
        <% nam = Name.find(v.reify.name_id) %>
        <% ver = v.reify%>
        <tr>
          <td><%= nam.name %></td>
          <td><%= Team.find(ver.team_id).name %></td>
          <td><%= ver.start.to_formatted_s(:long)  %></td>
          <td><%= ver.end.to_formatted_s(:long) unless !ver.end  %></td>
          <td><%= ver.fte %></td>
          <td><%= ver.brexit %></td>
      <% end %>
    <% end %>
  </tr>
</table>
<%= link_to 'Edit', edit_person_path(@person) %> |
<%= link_to 'Back', people_path %>
